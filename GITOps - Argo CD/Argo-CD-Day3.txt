# Session 3 - Helm Chart Integration with Argo CD | Multi-tier Application

## ğŸ“ Directory Structure
Organized structure for Helm and Argo CD deployment:

```
multi-tier-app/
â”œâ”€â”€ charts/
â”‚   â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ backend/
â”‚   â””â”€â”€ database/
â”œâ”€â”€ values/
â”‚   â”œâ”€â”€ frontend-values.yaml
â”‚   â”œâ”€â”€ backend-values.yaml
â”‚   â””â”€â”€ db-values.yaml
â”œâ”€â”€ helmfile.yaml (optional)
â””â”€â”€ argo-apps/
    â”œâ”€â”€ frontend-app.yaml
    â”œâ”€â”€ backend-app.yaml
    â””â”€â”€ db-app.yaml
```

---
-------------------------------------------------------
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: lwebapphelm1
spec:
  project: default
  destination:
    server: https://kubernetes.default.svc
    namespace: default
  source:
    helm:
      releaseName: lwapphelm
      parameters:
        - name: "replicaCount"
          value: "3"  # You can change this value as needed
    repoURL: https://github.com/vimal11inuxworld13/argocd_training_2024_code.git
    path: myHelmCharts/lwchart
    targetRevision: master
--------------------------------------------------------------------------------












----------------------------------------------------------------------------------

## âš™ï¸ Install Helm
```bash
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
helm version
```

---

## ğŸ› ï¸ Create Helm Charts
```bash
helm create frontend
helm create backend
helm create database
```
- Modify `templates/` and `values.yaml` to define Kubernetes resources and configurations like:
  - `replicaCount`
  - `image.repository`
  - `service.port`

---

## ğŸ”— Integrate Helm Charts with Argo CD
Create Argo CD Application YAML for each microservice:

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: frontend-app
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://github.com/youruser/multi-tier-app.git
    targetRevision: HEAD
    path: charts/frontend
    helm:
      valueFiles:
        - ../../values/frontend-values.yaml
  destination:
    server: https://kubernetes.default.svc
    namespace: dev
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
```

---

## ğŸ” Auto Sync
Automatically syncs your application when changes are detected:

```yaml
syncPolicy:
  automated:
    prune: true
    selfHeal: true
```

---

## ğŸ§¹ Prune Resources
Removes obsolete Kubernetes resources not defined in Git:
```yaml
prune: true
```

---

## ğŸ”¢ Replicas Count
Defined in `values.yaml` for each chart:
```yaml
replicaCount: 3
```

---

## ğŸ”„ Deployment Strategy
Defined in `deployment.yaml`:
```yaml
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 1
```

---

## â†©ï¸ Rollback
Rollback to a previous revision:
```bash
argocd app history frontend-app
argocd app rollback frontend-app <revision>
```

---

## ğŸ§© Parameters (Helm Values Override)
Override Helm values with `--set` or through Argo CD YAML:

### CLI:
```bash
helm upgrade --install frontend ./frontend --set image.tag=1.2.3
```

### Argo CD YAML:
```yaml
helm:
  parameters:
    - name: image.tag
      value: "1.2.3"
```

---

> âœ… This session covers deploying a complete multi-tier application using Helm and Argo CD, ensuring automated GitOps practices with rollback, scaling, and configuration strategies.

